# cat <<EOT > /dev/null

# # ref: http://www.linuxized.com/2010/05/switching-from-gnu-screen-to-tmux/
# /usr/share/tmux/screen-keys.conf
# tmux list-keys
# tmux list-commands # inside tmux
# tmux source-file ~/.tmux.conf  # for reload it at runtime
# prefix + ~ to show previous tmux messages (useful for debug)
# ref: http://mutelight.org/articles/practical-tmux
#
# tmux detach-client # fixed broken connection wrong window size problem
#
# ref: http://www.howtoforge.com/sharing-terminal-sessions-with-tmux-and-screen
# separate mode:
#   joy$ tmux -S /tmp/s new -s joy
#   tom$ tmux -S /tmp/s new -s tom -t joy 
#   # c-a c-d to detach
#   tom$ tmux -S /tmp/s a  # attach
# pair mode:
#   joy$ tmux -S /tmp/s new -s joy
#   tom$ tmux -S /tmp/s a -t tom
# read only mode:
#   joy$ tmux -S /tmp/s new -s joy
#   tom$ tmux -S /tmp/s a -t joy -r

# key settings {{{1
set-option -g prefix C-a
unbind-key C-b
# C-A C-A to last active window
bind-key C-a last-window
# C-A a to send real Ctrl-A
bind-key a send-prefix
bind < swap-window -t -1
bind > swap-window -t +1
bind X confirm-before -p "kill all? (y/n)" kill-session

# http://stackoverflow.com/questions/25657678/how-to-duplicate-ssh-session-on-tmux
#bind S neww "$(ps -ao pid,tty,args | sort | awk '$1 ~ /#{pane_pid}/{VAR=$2} $2 ~ VAR && $3 ~ /ssh/{$1=\"\"; $2=\"\"; print}')"
# the following can NOT work on RH6.6 tmux-1.6
#bind S neww "$(ps -aeo pid,ppid,args | sort | awk '($1 == #{pane_pid || $2 == #{pane_pid}) && $3 == \"ssh\" {$1=\"\"; $2=\"\"; print; exit 0}')"

# use vi keys to copy & paste
#http://stackoverflow.com/questions/11042920/how-to-copy-and-paste-between-different-tmux-panes-running-vim-instances
setw -g mode-keys vi
bind [ copy-mode
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-selection
bind -t vi-copy V rectangle-toggle
bind ] paste-buffer
bind Space choose-buffer

# http://stackoverflow.com/questions/13668633/split-pane-switching-in-tmux-switch-once-per-command
bind-key Up    select-pane -U
bind-key Down  select-pane -D
bind-key Left  select-pane -L
bind-key Right select-pane -R

# use vi key to select panel
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# use vi key to resize panel
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# use vi key to select window, -r for repeatable
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# session log
bind-key E pipe-pane "exec cat >> $HOME/tmp/log/'#W-tmux.log'" \; display-message 'logging to $HOME/#W-tmux.log'
bind-key e pipe-pane \; display-message 'Ended logging to $HOME/#W-tmux.log'

##Requires prefix key before the command key
#Copy tmux paste buffer to CLIPBOARD
bind C-c run "tmux save-buffer - | xclip -i -selection clipboard"
#Copy CLIPBOARD to tmux paste buffer and paste tmux paste buffer
bind C-v run "tmux set-buffer -- \"$(xclip -o -selection clipboard)\"; tmux paste-buffer"

# mouse settings {{{1
#set-option -g mode-mouse on
#set-option -g mouse-resize-pane on
#set-option -g mouse-select-pane on
#set-option -g mouse-select-window on

# status line settings {{{1
set -g base-index 1 		# index from 1
set -s escape-time 0 		# faster response
set -sg repeat-time 600         # increase repeat timeout
setw -g aggressive-resize on 	# resize to smallest ACTIVE window

# monitor
setw -g monitor-activity on
set -g visual-activity on
# Highlight active window
set -g window-status-current-bg cyan
set -g window-status-current-attr bold
# setw -g automatic-rename # may use more cpu
#set -g default-terminal "screen-256color"
set -g terminal-overrides 'xterm*:smcup@:rmcup@'
#set -g default-terminal "linux"

set -g status on
#set -g history-limit 4096
set -g status-bg green
#set -g status-bg black
#set -g status-fg white
# show last 15 min average load
set -g status-right '#8H#[fg=yellow]#(uptime|cut -d, -f6)'
# the following line can not work on tmux 1.6
#set -g status-left '#{pane_pid}'

set-option -g status-keys vi
set-option -g bell-action any
set-option -g allow-rename off
set-option -g set-titles off  # for xterm title
# set-option -g set-titles-string '#H:#S.#I.#P #W #T' # windowNo,progName,active/not
set-option -g visual-bell on


# utf8 {{{1

# for older tmux version
#set -g utf8
#setw -g utf8 on
#set-option -g status-utf8 on

#set-option -g mouse-utf8 on

bind m run "cut -c3- ~/.tmux.conf | sh -s toggle_mouse"
bind z run "cut -c3- ~/.tmux.conf | sh -s toggle_maximum"
bind Z run "cut -c3- ~/.tmux.conf | sh -s toggle_maximum v"

# EOT
#
# set -e
# toggle_maximum() {
#   if [ "$(tmux -V)" = "tmux 1.6" ] ; then
#     if [ "$1" = v ] ; then
#       tmux join-pane -v -t:-1
#     else
#       tmux join-pane -t:-1
#     fi
#   else
#     tmux resize-pane -Z
#   fi
#   #if [ -r ~/.tmux.max ] ; then
#   #  tmux display 'ctrl-a ! to maxium to new window'
#   #  tmux confirm-before -p "join-back" command
#   #  rm -f ~/.tmux.max
#   #else
#   #  n=$(tmux list-panes|wc -l)
#   #  if [ $n -gt 1 ] ; then
#   #    touch ~/.tmux.max
#   #    tmux break-pane
#   #  fi
#   #fi
# #[dlin@ap-dev03 ~]$ tmux joinp -t 20
#   #tmux display "pane_id=#{pane_id}"
#   # tmux rename-session -t'#{pane_id}'
# }
# toggle_mouse() {
#   if (tmux show -g -w |grep -q mode-mouse); then
#     old=$(tmux show -g -w | grep mode-mouse | cut -d' ' -f2)
#     if [ "$old" = "on" ] ; then
#       new="off"
#     else
#       new="on"
#     fi
#
#     tmux set -g mode-mouse $new \;\
#          set -g mouse-resize-pane $new \;\
#          set -g mouse-select-pane $new \;\
#          set -g mouse-select-window $new \;\
#          display "mouse: $new"
#   else
#     old=$(tmux show -g | grep mouse | head -n 1 | cut -d' ' -f2)
#     if [ "$old" = "on" ] ; then
#       new="off"
#     else
#       new="on"
#     fi
#
#     tmux set -g mouse $new \;\
#          display "mouse: $new"
#   fi
# }
#
# $@
# # vim:set et sw=2 ts=2 ai
